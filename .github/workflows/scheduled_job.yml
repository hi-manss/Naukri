name: Scheduled Naukri Job

# Allow manual runs for immediate testing + scheduled runs
on:
  workflow_dispatch:
  schedule:
    - cron: '0 6 * * *'   # Runs daily at 06:00 UTC (change time if needed)

jobs:
  run-naukri:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'   # Use 3.10 compatible with Selenium

      - name: Debug workspace
        run: |
          echo "Current directory:"
          pwd
          echo "Contents:"
          ls -la

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          fi

      # Optional: Inject GitHub Secrets into constants.py
      # Add these secrets in: Settings → Secrets → Actions:
      # NAUKRI_USERNAME, NAUKRI_PASSWORD, NAUKRI_MOBILE
      - name: Inject secrets into constants.py
        if: ${{ secrets.NAUKRI_USERNAME && secrets.NAUKRI_PASSWORD }}
        run: |
          cp constants.py constants.py.bak || true
          python - <<'PY'
import re
import os

file_path = "constants.py"
if not os.path.exists(file_path):
    print("constants.py not found — skipping secret injection.")
    exit(0)

content = open(file_path).read()

replacements = {
    r'USERNAME\s*=\s*["\'].*?["\']': f'USERNAME = "{os.environ["NAUKRI_USERNAME"]}"',
    r'PASSWORD\s*=\s*["\'].*?["\']': f'PASSWORD = "{os.environ["NAUKRI_PASSWORD"]}"',
    r'MOBILE\s*=\s*["\'].*?["\']':   f'MOBILE = "{os.environ["NAUKRI_MOBILE"]}"',
}

for pattern, replacement in replacements.items():
    content = re.sub(pattern, replacement, content)

with open(file_path, "w") as f:
    f.write(content)

print("constants.py updated with GitHub secrets.")
PY
        env:
          NAUKRI_USERNAME: ${{ secrets.NAUKRI_USERNAME }}
          NAUKRI_PASSWORD: ${{ secrets.NAUKRI_PASSWORD }}
          NAUKRI_MOBILE: ${{ secrets.NAUKRI_MOBILE }}

      - name: Run Naukri automation
        run: |
          echo "Running naukri.py..."
          python naukri.py
